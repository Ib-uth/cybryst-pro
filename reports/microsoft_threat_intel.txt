MICROSOFT THREAT INTELLIGENCE CENTER
DEFENDER THREAT INTELLIGENCE REPORT
=====================================

THREAT ACTOR: DEV-0243 (Storm-0558)
CAMPAIGN: Cloud Account Takeover
DATE: May 10, 2024
THREAT LEVEL: HIGH

EXECUTIVE SUMMARY
Microsoft's Threat Intelligence Center has identified a sophisticated cloud account takeover campaign targeting government and enterprise organizations. The threat actor, tracked as DEV-0243, has developed novel techniques for compromising cloud authentication systems and maintaining persistent access to cloud environments.

ATTACK VECTOR ANALYSIS

INITIAL ACCESS METHODS
1. OAuth Application Abuse
   - Malicious OAuth applications registered in Azure AD
   - Application IDs: 12345678-1234-1234-1234-123456789abc
   - Redirect URIs: https://malicious-app.oauth-phishing.com/callback

2. SAML Token Forgery
   - Exploiting weak SAML signature validation
   - Using stolen signing certificates
   - Bypassing multi-factor authentication

3. Password Spray Attacks
   - Targeting weak or reused passwords
   - Using common password patterns
   - Avoiding account lockout mechanisms

CLOUD INFRASTRUCTURE COMPROMISE

AZURE AD ENUMERATION
Compromised Objects:
- User Accounts: 1,247 affected
- Service Principals: 89 compromised
- Applications: 156 malicious apps
- Groups: 34 security groups modified

PowerShell Commands Used:
```powershell
Get-AzureADUser -All $true | Select-Object UserPrincipalName, ObjectId
Get-AzureADApplication -All $true | Select-Object DisplayName, AppId
Get-AzureADGroup -All $true | Select-Object DisplayName, ObjectId
```

OFFICE 365 COMPROMISE
Mailbox Access:
- 342 mailboxes accessed
- 156,789 emails exfiltrated
- 23,456 attachments downloaded

SharePoint Sites:
- 89 sites compromised
- 12,345 documents accessed
- 5,678 files modified

Teams Communications:
- 45 teams infiltrated
- 234 channels monitored
- 1,567 messages intercepted

MICROSOFT GRAPH API ABUSE
API Endpoints Exploited:
- /users (User enumeration)
- /mail (Email access)
- /files (File access)
- /contacts (Contact harvesting)
- /calendar (Calendar surveillance)

Access Tokens:
- Bearer Token: eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiIsIng1dCI6Ik1uQ19WWmNBVGZNNXBPWWlKSE1iYTlnb0VLWSIsImtpZCI6Ik1uQ19WWmNBVGZNNXBPWWlKSE1iYTlnb0VLWSJ9
- Scope: https://graph.microsoft.com/.default
- Expires: 2024-05-11T14:30:00Z

PERSISTENCE MECHANISMS

CONDITIONAL ACCESS BYPASS
Methods Used:
1. Device Registration Abuse
   - Registering malicious devices as trusted
   - Exploiting device compliance policies
   - Bypassing location-based restrictions

2. Application Consent Abuse
   - Requesting excessive permissions
   - Using deceptive consent screens
   - Exploiting admin consent workflows

3. Privilege Escalation
   - Adding compromised accounts to admin groups
   - Modifying role assignments
   - Exploiting service principal permissions

ADVANCED EVASION TECHNIQUES

CLOUD SECURITY BYPASS
Microsoft Defender for Office 365 Evasion:
- Using encrypted attachments
- Exploiting safe attachment delays
- Leveraging legitimate cloud services

Azure Security Center Evasion:
- Disabling security monitoring
- Modifying security policies
- Exploiting configuration drift

MULTI-CLOUD PERSISTENCE
Cross-Cloud Access:
- AWS: IAM roles compromised
- Google Cloud: Service accounts abused
- Azure: Managed identities exploited

Data Exfiltration Channels:
- Microsoft Teams file sharing
- OneDrive sync abuse
- SharePoint external sharing
- Power BI data export

INDICATORS OF COMPROMISE (IOCs)

DOMAIN NAMES
Suspicious Domains:
- oauth-consent.malicious-apps.com
- microsoft-verification.fake-domain.net
- azure-signin.phishing-site.org
- office365-login.suspicious-domain.info

Subdomain Patterns:
- *-oauth.malicious-domain.com
- *-consent.fake-site.net
- *-verification.phishing-org.info

IP ADDRESSES
Command and Control:
- 203.0.113.45 (Primary C2)
- 198.51.100.78 (Secondary C2)
- 192.0.2.156 (Backup C2)
- 203.0.113.89 (Exfiltration endpoint)

Geographic Distribution:
- United States: 45.67.89.123
- Germany: 185.220.101.42
- Russia: 91.92.240.118
- China: 123.123.123.123

FILE HASHES
Malicious Applications:
- SHA256: 7f8e9a2b4c6d1e3f5a7b9c0d2e4f6a8b0c1d3e5f7a9b2c4d6e8f0a1b3c5d7e9f1a2
- MD5: a1b2c3d4e5f6789012345678901234ab
- File: oauth-consent-app.exe

PowerShell Scripts:
- SHA256: 8a9b2c3d4e5f6a7b8c9d0e1f2a3b4c5d6e7f8a9b0c1d2e3f4a5b6c7d8e9f0a1b2c3
- MD5: b2c3d4e5f6789012345678901234abc
- File: azure-enumeration.ps1

REGISTRY KEYS
Persistence Registry Entries:
- HKEY_CURRENT_USER\Software\Microsoft\Office\16.0\Common\Identity\EnableADAL
- HKEY_LOCAL_MACHINE\SOFTWARE\Microsoft\Windows\CurrentVersion\Authentication\LogonUI\CredUI
- HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Internet Settings\Zones

SERVICES AND PROCESSES
Malicious Services:
- Service Name: "Microsoft Graph API Helper"
- Display Name: "Microsoft Graph API Helper Service"
- Binary Path: "C:\Program Files\Microsoft Graph API\graph-helper.exe"

Suspicious Processes:
- Process Name: graph-api-client.exe
- PID: 1234
- Command Line: "C:\Program Files\Microsoft Graph API\graph-api-client.exe --silent --token-file=token.json"

MITRE ATT&CK CLOUD MAPPING

INITIAL ACCESS
- T1078.004 - Valid Accounts: Cloud Accounts
- T1566.001 - Phishing: Spearphishing Attachment
- T1190 - Exploit Public-Facing Application

EXECUTION
- T1059.001 - Command and Scripting Interpreter: PowerShell
- T1204.002 - User Execution: Malicious File

PERSISTENCE
- T1098.001 - Account Manipulation: Additional Cloud Credentials
- T1098.002 - Account Manipulation: Additional Cloud Roles

PRIVILEGE ESCALATION
- T1078.004 - Valid Accounts: Cloud Accounts
- T1098.002 - Account Manipulation: Additional Cloud Roles

DEFENSE EVASION
- T1562.001 - Impair Defenses: Disable or Modify Tools
- T1027 - Obfuscated Files or Information

CREDENTIAL ACCESS
- T1552.001 - Unsecured Credentials: Credentials in Files
- T1552.002 - Unsecured Credentials: Credentials in Registry

DISCOVERY
- T1083 - File and Directory Discovery
- T1082 - System Information Discovery
- T1018 - Remote System Discovery

LATERAL MOVEMENT
- T1021.001 - Remote Services: Remote Desktop Protocol
- T1078.004 - Valid Accounts: Cloud Accounts

COLLECTION
- T1005 - Data from Local System
- T1039 - Data from Network Shared Drive

COMMAND AND CONTROL
- T1071.001 - Application Layer Protocol: Web Protocols
- T1573.002 - Encrypted Channel: Asymmetric Cryptography

EXFILTRATION
- T1041 - Exfiltration Over C2 Channel
- T1048.003 - Exfiltration Over Alternative Protocol

IMPACT
- T1486 - Data Encrypted for Impact
- T1499 - Endpoint Denial of Service

DETECTION RECOMMENDATIONS

MICROSOFT DEFENDER MONITORING
Azure AD Sign-in Logs:
- Monitor for suspicious sign-in patterns
- Alert on unusual geographic locations
- Track application consent activities

Office 365 Audit Logs:
- Monitor mailbox access patterns
- Track file sharing activities
- Alert on bulk data exports

Azure Activity Logs:
- Monitor role assignment changes
- Track service principal modifications
- Alert on configuration changes

SIEM INTEGRATION
Recommended Queries:
```kql
SigninLogs
| where UserPrincipalName contains "compromised-user"
| where AppDisplayName contains "malicious-app"
| where IPAddress in ("203.0.113.45", "198.51.100.78")

OfficeActivity
| where Operation == "FileAccessed"
| where UserId contains "compromised-user"
| where SourceFileName contains "sensitive-document"
```

MITIGATION STRATEGIES

IMMEDIATE ACTIONS
1. Review and revoke suspicious OAuth applications
2. Reset passwords for all potentially compromised accounts
3. Enable additional conditional access policies
4. Deploy enhanced monitoring and alerting

LONG-TERM MEASURES
1. Implement zero-trust architecture
2. Deploy cloud access security broker (CASB)
3. Regular security awareness training
4. Continuous security monitoring
5. Regular penetration testing

CONCLUSION
This campaign demonstrates the evolving sophistication of cloud-focused threat actors. Organizations must implement comprehensive cloud security controls and maintain continuous monitoring to detect and respond to such advanced threats.
